# Energy Saving Automatic Outside Light Project
This detailed overview provides insights into the code structure and functionalities of the Energy Saving Automatic Outside Light project. The system is designed around a microcontroller-based architecture, utilizing various peripherals, interrupts, and algorithms to achieve its goals.

## Code Structure and Key Components
### Main Loop (main function)
- Variables Initialization: The main loop starts with initializing variables relevant to timekeeping (such as day, year, and flags for daylight savings adjustments) and configuring the initial state of the system (e.g., LED states).
System Initialization: Calls an initialise() function to set up peripherals, configure interrupts, and prepare the system for operation.
- Infinite Loop: The core of the program runs in an endless loop, continuously checking light levels, updating the time display, and adjusting lighting based on the current time and ambient light conditions.
Interrupts and Timer Configuration
- Interrupt Initialization: The Interrupts_init() function configures global and peripheral interrupts for the system, enabling specific sources such as comparators and timers, which are crucial for timekeeping and event detection.
- Timer Setup: Timer0_init() sets up a hardware timer (Timer 0) used for timekeeping. The timer is configured to overflow at a rate that allows the system to increment the hour variable, effectively keeping track of time.
  
- Interrupt Service Routines (ISR): The LowISR() function handles low-priority interrupts, including the timer overflow interrupt for incrementing the hour and comparator interrupts for detecting changes in light levels.
### Day and Night Detection Using Comparator and Interrupts
In the Energy Saving Automatic Outside Light project, the detection of day and night transitions is efficiently managed through the use of comparators and interrupts, facilitating the automatic control of outdoor lighting based on ambient light conditions.

- Comparator Configuration for Edge Detection: The system utilizes two comparators to detect changes in light levels, indicative of transitions between day and night. These comparators are set up to identify the rising and falling edges of the signal from a Light Dependent Resistor (LDR), which varies with ambient light intensity.

- Daytime Transition (Rising Edge): Upon receiving an interrupt from the rising edge detector (comparator 1), the system executes actions indicating a transition to daytime, such as turning off the LED (LATHbits.LATH3 = 0) to conserve energy during daylight hours.

- Nighttime Transition (Falling Edge): When the falling edge detector (comparator 2) triggers an interrupt, the system responds by activating the LED (LATHbits.LATH3 = 1), providing necessary illumination through the night.

- Interrupt Handling for Light Level Changes: The system's interrupt service routine, LowISR(), handles the interrupts generated by the comparators, alongside other system interrupts such as timer overflows. This routine includes specific blocks to respond to the comparator interrupts:


- Ensuring Responsive and Energy-Efficient Lighting: Through the adept use of comparators and interrupts, the system achieves a responsive control mechanism that adapts outdoor lighting based on real-world conditions. This setup not only enhances the system's energy efficiency by ensuring lights are only on when needed but also contributes to safety and convenience in outdoor spaces by providing illumination during the night and turning off lights during the day or early morning hours.
### Daylight Savings and Time Adjustment
- Daylight Savings Calculation: The system calculates the start and end dates for daylight savings time within the findDSTdates() function. It adjusts the clock accordingly to ensure that the system reflects the correct time.
  
- Hour Adjustment: The increaseHour() function manages the increment of the hour variable and adjusts for the transition into and out of daylight savings time. It also handles the logic for turning off the light during predefined early morning hours (1 am to 5 am).
  
- Time Synchronization: Adjustments based on the detection of dusk and dawn times help the system stay in sync with solar time, compensating for any drift in the microcontroller's internal clock.
Light Level Monitoring and LED Control

- Comparator and DAC Setup: DAC_init(), Comp1_init_re(), and Comp1_init_fe() functions configure the digital-to-analog converter and comparators for monitoring ambient light through the LDR. These peripherals generate interrupts when light levels cross predefined thresholds, triggering the system to turn the LED on or off.
  
- LED Display: The LEDarray_disp_bin() function displays the current hour on the LED array in binary format, providing a visual indication of time that is easily understood in testing mode.
### Displaying Time, Day, and Year
The LCD is programmed to display the current time in a human-readable format, providing insights into the system's internal timekeeping mechanisms. Additionally, it shows the day and year, offering a complete temporal context for the system's operation. This feature is particularly useful in public installations where such information might be valuable to passersby or maintenance personnel.

- Leap Year Indication: Given the importance of accurately handling leap years for timekeeping and daylight savings adjustments, the system includes a leap year indicator on the LCD. This indicator informs users whether the current year accounts for an extra day in February, ensuring transparency in the system's date management logic.

- Utility in Testing Mode: In testing mode, the LCD becomes an invaluable tool for developers and technicians. It allows for real-time monitoring of the system's state, including the current time acceleration (when a day is simulated in a condensed timeframe), the detection of daylight savings adjustments, and the response to light level changes. This immediate feedback accelerates troubleshooting and fine-tuning of the system, enhancing the development process.

- Public Display Functionality: When deployed in public spaces, the LCD display provides additional utility beyond the primary lighting control. By showing the current time, day, and year, it offers a public service, akin to a digital clock or calendar display. 
### Testing Mode
- Mode Selection: A #define mode directive at the beginning of the code allows switching between normal operation and a testing mode, where a day is simulated in a condensed timeframe (e.g., 24 seconds).
- Testing Adjustments: In testing mode, time increments and light sensitivity adjustments are scaled to allow rapid verification of the system's functionality.
### Usage and Maintenance
- Initial Configuration: Upon the first setup, users might need to manually input the current day and time to initialize the system accurately.
- Automatic Operation: Post-initialization, the system requires no user intervention, automatically adjusting lighting based on time and ambient light levels.
## Conclusion
The code for the Energy Saving Automatic Outside Light project is designed to be efficient, modular, and adaptable. Through careful organization and the use of microcontroller peripherals and interrupts, the project achieves its goal of providing an automated, energy-efficient outdoor lighting solution. This overview provides a foundation for understanding the system's operation, aiding in maintenance, adaptation, or further development of similar projects.


[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg)](https://classroom.github.com/a/hkDdx-pz)
# Mini project - Energy saving automatic outside light

## Learning outcomes

The principal learning objectives for this project are:

- Implement a working microprocessor based system to achieve a more complex real world task
- Develop your ability to independently plan, organise and structure your code 
- Improve your grasp of the C language and writing your own functions

## Brief

Outside lights that respond to ambient light levels are commonplace (i.e. street lights, porch lights, garden lights etc). These types of lights switch on at dusk and then turn off at dawn. However, energy and money can be saved if these lights are switched off during the small hours of the morning (for example, between 1am and 5am), when there are very few people around. Many councils in the UK have implemented/trialled this idea for street lights (https://www.bbc.co.uk/news/uk-england-derbyshire-16811386). Your task is to use the knowledge of microcontrollers and hardware that you have gained in labs 1-3 from this module to develop a fully automated solution.

## Specification
Design and program a device that meets the following requirements:

1. Monitors light level with the LDR and turns on an LED in low light conditions (i.e. night-time) and off in bright conditions (i.e. daytime)
1. Displays the current hour of day on the LED array in binary
1. Turns the light off between approx. 1am and 5am
1. Adjusts for daylight savings time
1. Maintain synchronicity with the sun indefinitely
1. Be fully automatic (requires zero maintenance after installation)

Please use this GitHub repo to manage your software development and submit your mini project code.

## Supplementary information and help
At first the task may seem quite straightforward but there are several points that often prove more tricky. The first is how to test code during development? You could test in real world conditions but you would be limited to one test cycle per day and this would severely slow down your development and debugging progress. To get around this you could implement a "testing mode" and pretend that a day lasts 24 seconds. This could be done using a #define directive to switch between "normal" and "testing" modes for your code.

Adjusting for daylight savings time is not too tricky. The clocks always change (in the UK) on the last Sunday in March (they go forward an hour) and the last Sunday in October (they go back an hour). One method of achieving this is to initialise what day it is when device is first switched on (using manual input) and then keep track of the days that pass and what the day of the week it is. Another method might be to automatically figure out what time of year it is (see below). Also don't forget about leap years! 

No clock is perfect, they can all run slightly fast/slow and can by influenced be external factors such as temperature. Ultimately this will result in drift over time and eventually the time will drift so far out of sync with real time that it is meaningless. For the purposes of our device the main requirement is that it remains in sync with the sun. You could use light from the sun to keep your clock in sync. Although the length of daylight varies considerably during the year, the midpoint between dusk and dawn only varies by a few minutes. This is termed solar midnight approx. 12am or solar noon approx. 12pm. One method of staying in sync with the sun is to use the LDR and record/calculate when these times occur and adjust your clock accordingly. The length of daylight also tells us information about what time of year it is and can be used to help us know when to adjust for daylight savings time.

![Day length](gifs/day-length-london.jpg)
http://wordpress.mrreid.org/2010/10/31/why-change-the-clocks/





